FROM ubuntu:22.04

# Install system dependencies
RUN apt update && \
    apt install -y curl unzip libssl-dev pkg-config build-essential nodejs npm

# Optional: install Node.js LTS manually if needed
# RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
#     apt-get install -y nodejs

# Install DFX (Internet Computer SDK)
RUN curl -sSL https://internetcomputer.org/install.sh | bash

# Add DFX to PATH
ENV PATH="/root/bin:$PATH"

# Create working directory
WORKDIR /project

# Install global Node.js dev tools with --unsafe-perm to avoid permission errors
RUN npm install -g --unsafe-perm \
    nodemon \
    ts-node \
    typescript \
    @types/node \
    eslint \
    prettier

# (Optional) Expose DFX default port if running it inside the container
EXPOSE 4943

# Default command (you can override in docker-compose.yml)
CMD ["bash"]
